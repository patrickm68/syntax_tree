#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "stackprof"

$:.unshift(File.expand_path("../lib", __dir__))
require "syntax_tree"

GC.disable

StackProf.run(mode: :cpu, out: "tmp/profile.dump", raw: true) do
  filepath = File.expand_path("../lib/syntax_tree/node.rb", __dir__)
  SyntaxTree.format(File.read(filepath))
end

GC.enable

`bundle exec stackprof --d3-flamegraph tmp/profile.dump > tmp/flamegraph.html`
puts "open tmp/flamegraph.html"
